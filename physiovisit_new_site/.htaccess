# PhysioVisit .htaccess - Image loading optimizations

# Enable compression for images and other assets
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Set proper MIME types for images
<IfModule mod_mime.c>
    AddType image/jpeg .jpg .jpeg
    AddType image/png .png
    AddType image/gif .gif
    AddType image/webp .webp
</IfModule>

# Cache images for better performance
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
</IfModule>

# Fix for case-sensitive file systems
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Redirect common image extensions with wrong case
    RewriteCond %{REQUEST_URI} \.(JPG|JPEG|PNG|GIF)$ [NC]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)\.JPG$ $1.jpg [R=301,L]
    RewriteRule ^(.*)\.JPEG$ $1.jpeg [R=301,L] 
    RewriteRule ^(.*)\.PNG$ $1.png [R=301,L]
    RewriteRule ^(.*)\.GIF$ $1.gif [R=301,L]
</IfModule>

# Security headers
<IfModule mod_headers.c>
    # Allow images from same origin and data URIs
    Header set Content-Security-Policy "img-src 'self' data: https:;"
    
    # Prevent hotlinking of images
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Error pages
ErrorDocument 404 /404.html

# Prevent access to sensitive files
<Files ~ "^\.">
    Order allow,deny
    Deny from all
</Files>